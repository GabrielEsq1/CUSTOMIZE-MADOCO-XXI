<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dise√±ador Interactivo MADOCO</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-gray: #f5f5f5;
            --dark-gray: #333;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f9f9f9;
            color: var(--dark-gray);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 0;
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .logo img {
            height: 40px;
        }
        
        .nav-links {
            display: flex;
            gap: 20px;
        }
        
        .nav-links a {
            color: white;
            text-decoration: none;
            transition: color 0.3s;
            font-weight: 500;
        }
        
        .nav-links a:hover {
            color: var(--secondary-color);
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 40px;
            margin-top: 20px;
        }
        
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .design-area {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
        }
        
        .design-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .view-buttons {
            display: flex;
            gap: 10px;
        }
        
        .view-btn {
            padding: 10px 20px;
            border: 1px solid #ddd;
            background: white;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .view-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .upload-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .upload-btn {
            padding: 10px 15px;
            border: 1px solid var(--secondary-color);
            background: white;
            color: var(--secondary-color);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .upload-btn:hover {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .canvas-container {
            width: 100%;
            height: 600px;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            position: relative;
            overflow: hidden;
            background: white;
            background-image: 
                linear-gradient(45deg, #f0f0f0 25%, transparent 25%),
                linear-gradient(-45deg, #f0f0f0 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #f0f0f0 75%),
                linear-gradient(-45deg, transparent 75%, #f0f0f0 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
        
        #interactive-canvas {
            width: 100%;
            height: 100%;
            cursor: default;
        }
        
        .element-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 10px;
            display: none;
            z-index: 1000;
        }
        
        .control-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px 10px;
            font-size: 16px;
            margin: 0 2px;
            border-radius: 3px;
            transition: background-color 0.3s;
        }
        
        .control-btn:hover {
            background-color: var(--light-gray);
        }
        
        .customization-options {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
            height: fit-content;
        }
        
        .option-group {
            margin-bottom: 30px;
            border-bottom: 1px solid #eee;
            padding-bottom: 25px;
        }
        
        .option-group:last-child {
            border-bottom: none;
        }
        
        .option-title {
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 18px;
            color: var(--primary-color);
        }
        
        .color-options {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .color-option {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .color-option:hover {
            transform: scale(1.1);
        }
        
        .color-option.active {
            border-color: var(--secondary-color);
        }
        
        .size-options {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .size-option {
            padding: 12px 18px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            min-width: 50px;
            text-align: center;
        }
        
        .size-option:hover {
            background-color: var(--light-gray);
        }
        
        .size-option.active {
            background-color: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }
        
        .transform-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        .transform-input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 100%;
        }
        
        .transform-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .checkbox-option {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .checkbox-option input {
            margin-right: 12px;
            transform: scale(1.2);
        }
        
        .quantity-selector {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-top: 10px;
        }
        
        .quantity-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 1px solid #ddd;
            background-color: white;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .quantity-btn:hover {
            background-color: var(--light-gray);
        }
        
        .quantity-value {
            font-size: 20px;
            font-weight: bold;
            min-width: 40px;
            text-align: center;
        }
        
        .add-to-cart {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 18px 30px;
            border-radius: var(--border-radius);
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: background-color 0.3s;
            margin-top: 25px;
        }
        
        .add-to-cart:hover {
            background-color: #c0392b;
        }
        
        .windows-activation {
            background-color: #f1f1f1;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-top: 25px;
            text-align: center;
            font-size: 14px;
            color: #666;
            border: 1px solid #ddd;
        }
        
        .section-divider {
            height: 1px;
            background-color: #eee;
            margin: 25px 0;
        }
        
        .product-info {
            text-align: center;
            margin-top: 20px;
        }
        
        .product-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .product-price {
            font-size: 20px;
            color: var(--accent-color);
            font-weight: bold;
        }
        
        .selection-outline {
            position: absolute;
            border: 2px dashed var(--secondary-color);
            pointer-events: none;
            display: none;
        }
        
        .resize-handle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--secondary-color);
            border: 1px solid white;
            border-radius: 50%;
            pointer-events: all;
            cursor: pointer;
        }
        
        .rotate-handle {
            position: absolute;
            width: 12px;
            height: 12px;
            background: var(--accent-color);
            border: 1px solid white;
            border-radius: 50%;
            pointer-events: all;
            cursor: grab;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <img src="{{ url_for('static', filename='LOGO-PRINCIPAL.svg') }}" alt="MADOCO Logo">
            </div>
            <div class="nav-links">
                <a href="{{ url_for('index') }}">Inicio</a>
                <a href="{{ url_for('custom') }}">Personalizar</a>
                <a href="{{ url_for('location') }}">Ubicaci√≥n</a>
            </div>
        </div>
    </header>
    
    <div class="container">
        <h1>Dise√±ador Interactivo MADOCO</h1>
        <p>Sube im√°genes y banderas, y mu√©velas para crear tu dise√±o perfecto.</p>
        
        <div class="section-divider"></div>
        
        <div class="main-content">
            <div class="design-area">
                <div class="design-controls">
                    <div class="view-buttons">
                        <button class="view-btn active" data-view="front">Front</button>
                        <button class="view-btn" data-view="back">Back</button>
                    </div>
                    <div class="upload-buttons">
                        <button class="upload-btn" id="upload-garment">Subir Prenda</button>
                        <button class="upload-btn" id="upload-flag">Subir Bandera</button>
                        <button class="upload-btn" id="upload-logo">Subir Logo</button>
                        <button class="upload-btn" id="add-default-flag">Bandera USA</button>
                        <button class="upload-btn" id="add-text">A√±adir Texto</button>
                    </div>
                </div>
                
                <div class="canvas-container">
                    <canvas id="interactive-canvas" width="1200" height="600"></canvas>
                    <div class="element-controls" id="element-controls">
                        <button class="control-btn" id="delete-element" title="Eliminar">üóëÔ∏è</button>
                        <button class="control-btn" id="bring-forward" title="Traer al frente">‚¨ÜÔ∏è</button>
                        <button class="control-btn" id="send-backward" title="Enviar atr√°s">‚¨áÔ∏è</button>
                        <button class="control-btn" id="flip-horizontal" title="Voltear horizontal">‚ÜîÔ∏è</button>
                        <button class="control-btn" id="flip-vertical" title="Voltear vertical">‚ÜïÔ∏è</button>
                    </div>
                </div>
                
                <div class="product-info">
                    <div class="product-title">Prenda de Trabajo Personalizada</div>
                    <div class="product-price">Precio: $160.40</div>
                </div>
            </div>
            
            <div class="customization-options">
                <div class="option-group">
                    <div class="option-title">Elegir Color de Prenda</div>
                    <div class="color-options">
                        <div class="color-option active" style="background-color: #555;" data-color="dark-grey"></div>
                        <div class="color-option" style="background-color: #2c3e50;" data-color="navy"></div>
                        <div class="color-option" style="background-color: #7f8c8d;" data-color="grey"></div>
                        <div class="color-option" style="background-color: #c0392b;" data-color="red"></div>
                        <div class="color-option" style="background-color: #16a085;" data-color="green"></div>
                    </div>
                </div>
                
                <div class="option-group">
                    <div class="option-title">Elegir Talla</div>
                    <div class="size-options">
                        <div class="size-option" data-size="XS">XS</div>
                        <div class="size-option" data-size="S">S</div>
                        <div class="size-option active" data-size="M">M</div>
                        <div class="size-option" data-size="L">L</div>
                        <div class="size-option" data-size="XL">XL</div>
                        <div class="size-option" data-size="XXL">XXL</div>
                    </div>
                </div>
                
                <div class="option-group">
                    <div class="option-title">Controles del Elemento Seleccionado</div>
                    <div class="transform-controls">
                        <div>
                            <div class="transform-label">Posici√≥n X</div>
                            <input type="number" id="pos-x" class="transform-input" min="0">
                        </div>
                        <div>
                            <div class="transform-label">Posici√≥n Y</div>
                            <input type="number" id="pos-y" class="transform-input" min="0">
                        </div>
                        <div>
                            <div class="transform-label">Ancho</div>
                            <input type="number" id="width" class="transform-input" min="10">
                        </div>
                        <div>
                            <div class="transform-label">Alto</div>
                            <input type="number" id="height" class="transform-input" min="10">
                        </div>
                        <div>
                            <div class="transform-label">Rotaci√≥n</div>
                            <input type="number" id="rotation" class="transform-input" min="0" max="360" step="1">
                        </div>
                        <div>
                            <div class="transform-label">Opacidad</div>
                            <input type="range" id="opacity" class="transform-input" min="0" max="100" value="100">
                        </div>
                    </div>
                </div>
                
                <div class="option-group">
                    <div class="option-title">Herramientas</div>
                    <div class="upload-buttons" style="justify-content: center;">
                        <button class="upload-btn" id="clear-all" style="background-color: #e74c3c; color: white; border-color: #e74c3c;">
                            Limpiar Todo
                        </button>
                        <button class="upload-btn" id="save-design" style="background-color: #27ae60; color: white; border-color: #27ae60;">
                            Guardar Dise√±o
                        </button>
                    </div>
                </div>
                
                <div class="option-group">
                    <div class="option-title">CANTIDAD</div>
                    <div class="quantity-selector">
                        <button class="quantity-btn" id="decrease">-</button>
                        <div class="quantity-value" id="quantity">1</div>
                        <button class="quantity-btn" id="increase">+</button>
                    </div>
                </div>
                
                <button class="add-to-cart">A√±adir al Carrito</button>
                
                <div class="windows-activation">
                    Activar Windows<br>
                    Ve a configuraci√≥n para activar Windows.
                </div>
            </div>
        </div>
    </div>

    <!-- Inputs ocultos para subir archivos -->
    <input type="file" id="garment-upload" accept="image/*" style="display: none;">
    <input type="file" id="flag-upload" accept="image/*" style="display: none;">
    <input type="file" id="logo-upload" accept="image/*" style="display: none;">

    <script>
        // Sistema de canvas interactivo
        class InteractiveDesigner {
            constructor() {
                this.canvas = document.getElementById('interactive-canvas');
                this.ctx = this.canvas.getContext('2d');
                this.elements = [];
                this.selectedElement = null;
                this.isDragging = false;
                this.isResizing = false;
                this.isRotating = false;
                this.dragStart = { x: 0, y: 0 };
                this.currentView = 'front';
                this.garmentColor = '#555';
                this.garmentImage = null;
                
                this.init();
            }
            
            init() {
                this.setupCanvas();
                this.setupEventListeners();
                this.setupControls();
                this.draw();
            }
            
            setupCanvas() {
                const rect = this.canvas.getBoundingClientRect();
                this.canvas.width = rect.width;
                this.canvas.height = rect.height;
            }
            
            setupEventListeners() {
                // Eventos del canvas
                this.canvas.addEventListener('mousedown', this.handleMouseDown.bind(this));
                this.canvas.addEventListener('mousemove', this.handleMouseMove.bind(this));
                this.canvas.addEventListener('mouseup', this.handleMouseUp.bind(this));
                this.canvas.addEventListener('wheel', this.handleWheel.bind(this));
                
                // Eventos de teclado
                document.addEventListener('keydown', this.handleKeyDown.bind(this));
                
                // Redimensionamiento
                window.addEventListener('resize', this.handleResize.bind(this));
            }
            
            setupControls() {
                // Subida de archivos
                document.getElementById('upload-garment').addEventListener('click', () => {
                    document.getElementById('garment-upload').click();
                });
                
                document.getElementById('upload-flag').addEventListener('click', () => {
                    document.getElementById('flag-upload').click();
                });
                
                document.getElementById('upload-logo').addEventListener('click', () => {
                    document.getElementById('logo-upload').click();
                });
                
                // Procesar archivos subidos
                document.getElementById('garment-upload').addEventListener('change', (e) => this.handleFileUpload(e, 'garment'));
                document.getElementById('flag-upload').addEventListener('change', (e) => this.handleFileUpload(e, 'element'));
                document.getElementById('logo-upload').addEventListener('change', (e) => this.handleFileUpload(e, 'element'));
                
                // Elementos predeterminados
                document.getElementById('add-default-flag').addEventListener('click', () => this.addDefaultFlag());
                document.getElementById('add-text').addEventListener('click', () => this.addTextElement());
                
                // Controles de elemento
                document.getElementById('delete-element').addEventListener('click', () => this.deleteSelectedElement());
                document.getElementById('bring-forward').addEventListener('click', () => this.bringForward());
                document.getElementById('send-backward').addEventListener('click', () => this.sendBackward());
                document.getElementById('flip-horizontal').addEventListener('click', () => this.flipHorizontal());
                document.getElementById('flip-vertical').addEventListener('click', () => this.flipVertical());
                
                // Controles de transformaci√≥n
                document.getElementById('pos-x').addEventListener('input', (e) => this.updateElementProperty('x', parseInt(e.target.value)));
                document.getElementById('pos-y').addEventListener('input', (e) => this.updateElementProperty('y', parseInt(e.target.value)));
                document.getElementById('width').addEventListener('input', (e) => this.updateElementProperty('width', parseInt(e.target.value)));
                document.getElementById('height').addEventListener('input', (e) => this.updateElementProperty('height', parseInt(e.target.value)));
                document.getElementById('rotation').addEventListener('input', (e) => this.updateElementProperty('rotation', parseInt(e.target.value)));
                document.getElementById('opacity').addEventListener('input', (e) => this.updateElementProperty('opacity', parseInt(e.target.value)));
                
                // Herramientas
                document.getElementById('clear-all').addEventListener('click', () => this.clearAll());
                document.getElementById('save-design').addEventListener('click', () => this.saveDesign());
                
                // Vista
                document.querySelectorAll('.view-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentView = e.target.dataset.view;
                        this.draw();
                    });
                });
                
                // Colores
                document.querySelectorAll('.color-option').forEach(option => {
                    option.addEventListener('click', (e) => {
                        document.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('active'));
                        e.target.classList.add('active');
                        this.garmentColor = e.target.style.backgroundColor;
                        this.draw();
                    });
                });
            }
            
            handleFileUpload(event, type) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        if (type === 'garment') {
                            this.garmentImage = img;
                        } else {
                            this.addElement({
                                type: 'image',
                                image: img,
                                x: 100,
                                y: 100,
                                width: 150,
                                height: 150,
                                rotation: 0,
                                opacity: 100
                            });
                        }
                        this.draw();
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
            
            addElement(elementData) {
                const element = {
                    id: Date.now() + Math.random(),
                    type: elementData.type,
                    x: elementData.x || 100,
                    y: elementData.y || 100,
                    width: elementData.width || 100,
                    height: elementData.height || 100,
                    rotation: elementData.rotation || 0,
                    opacity: elementData.opacity || 100,
                    scaleX: 1,
                    scaleY: 1,
                    ...elementData
                };
                
                this.elements.push(element);
                this.selectElement(element);
                return element;
            }
            
            addDefaultFlag() {
                const flagSVG = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMTAwIiBoZWlnaHQ9IjUwIiBmaWxsPSIjYmYwYjI2Ii8+PHJlY3QgeD0iMCIgeT0iNTAiIHdpZHRoPSIxMDAiIGhlaWdodD0iNTAiIGZpbGw9IiNmZmYiLz48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMzAiIGhlaWdodD0iMTAwIiBmaWxsPSIjMDAzODg2Ii8+PHN0YXIgeD0iMTUiIHk9IjUwIiBmaWxsPSIjZmZmIi8+PC9zdmc+';
                
                const img = new Image();
                img.onload = () => {
                    this.addElement({
                        type: 'image',
                        image: img,
                        x: 150,
                        y: 150,
                        width: 120,
                        height: 80,
                        rotation: 0,
                        opacity: 100
                    });
                };
                img.src = flagSVG;
            }
            
            addTextElement() {
                this.addElement({
                    type: 'text',
                    text: 'Tu texto aqu√≠',
                    fontSize: 24,
                    fontFamily: 'Arial',
                    color: '#000000',
                    x: 200,
                    y: 200,
                    width: 150,
                    height: 40,
                    rotation: 0,
                    opacity: 100
                });
            }
            
            handleMouseDown(e) {
                const rect = this.canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                this.dragStart = { x, y };
                
                // Buscar elemento bajo el cursor
                const element = this.getElementAt(x, y);
                
                if (element) {
                    this.selectElement(element);
                    this.isDragging = true;
                } else {
                    this.selectElement(null);
                }
                
                this.draw();
            }
            
            handleMouseMove(e) {
                if (!this.selectedElement) return;
                
                const rect = this.canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                if (this.isDragging) {
                    const dx = x - this.dragStart.x;
                    const dy = y - this.dragStart.y;
                    
                    this.selectedElement.x += dx;
                    this.selectedElement.y += dy;
                    
                    this.dragStart = { x, y };
                    this.updateTransformControls();
                    this.draw();
                }
            }
            
            handleMouseUp() {
                this.isDragging = false;
                this.isResizing = false;
                this.isRotating = false;
            }
            
            handleWheel(e) {
                if (!this.selectedElement) return;
                
                e.preventDefault();
                const delta = e.deltaY > 0 ? -5 : 5;
                
                this.selectedElement.rotation = (this.selectedElement.rotation + delta) % 360;
                this.updateTransformControls();
                this.draw();
            }
            
            handleKeyDown(e) {
                if (!this.selectedElement) return;
                
                const step = e.shiftKey ? 10 : 1;
                
                switch(e.key) {
                    case 'ArrowUp':
                        this.selectedElement.y -= step;
                        break;
                    case 'ArrowDown':
                        this.selectedElement.y += step;
                        break;
                    case 'ArrowLeft':
                        this.selectedElement.x -= step;
                        break;
                    case 'ArrowRight':
                        this.selectedElement.x += step;
                        break;
                    case 'Delete':
                        this.deleteSelectedElement();
                        break;
                    case 'Escape':
                        this.selectElement(null);
                        break;
                }
                
                this.updateTransformControls();
                this.draw();
            }
            
            handleResize() {
                this.setupCanvas();
                this.draw();
            }
            
            getElementAt(x, y) {
                for (let i = this.elements.length - 1; i >= 0; i--) {
                    const element = this.elements[i];
                    
                    // Transformaci√≥n simple para verificar colisi√≥n
                    const left = element.x;
                    const right = element.x + element.width;
                    const top = element.y;
                    const bottom = element.y + element.height;
                    
                    if (x >= left && x <= right && y >= top && y <= bottom) {
                        return element;
                    }
                }
                return null;
            }
            
            selectElement(element) {
                this.selectedElement = element;
                this.updateTransformControls();
                this.toggleElementControls(!!element);
            }
            
            updateTransformControls() {
                if (!this.selectedElement) return;
                
                document.getElementById('pos-x').value = Math.round(this.selectedElement.x);
                document.getElementById('pos-y').value = Math.round(this.selectedElement.y);
                document.getElementById('width').value = Math.round(this.selectedElement.width);
                document.getElementById('height').value = Math.round(this.selectedElement.height);
                document.getElementById('rotation').value = Math.round(this.selectedElement.rotation);
                document.getElementById('opacity').value = Math.round(this.selectedElement.opacity);
            }
            
            updateElementProperty(property, value) {
                if (!this.selectedElement) return;
                
                this.selectedElement[property] = value;
                this.draw();
            }
            
            toggleElementControls(show) {
                const controls = document.getElementById('element-controls');
                controls.style.display = show ? 'block' : 'none';
            }
            
            deleteSelectedElement() {
                if (!this.selectedElement) return;
                
                const index = this.elements.indexOf(this.selectedElement);
                if (index > -1) {
                    this.elements.splice(index, 1);
                }
                
                this.selectElement(null);
                this.draw();
            }
            
            bringForward() {
                if (!this.selectedElement) return;
                
                const index = this.elements.indexOf(this.selectedElement);
                if (index < this.elements.length - 1) {
                    this.elements.splice(index, 1);
                    this.elements.push(this.selectedElement);
                    this.draw();
                }
            }
            
            sendBackward() {
                if (!this.selectedElement) return;
                
                const index = this.elements.indexOf(this.selectedElement);
                if (index > 0) {
                    this.elements.splice(index, 1);
                    this.elements.unshift(this.selectedElement);
                    this.draw();
                }
            }
            
            flipHorizontal() {
                if (!this.selectedElement) return;
                this.selectedElement.scaleX *= -1;
                this.draw();
            }
            
            flipVertical() {
                if (!this.selectedElement) return;
                this.selectedElement.scaleY *= -1;
                this.draw();
            }
            
            clearAll() {
                if (confirm('¬øEst√°s seguro de que quieres eliminar todos los elementos?')) {
                    this.elements = [];
                    this.selectedElement = null;
                    this.toggleElementControls(false);
                    this.draw();
                }
            }
            
            saveDesign() {
                // Aqu√≠ puedes implementar la l√≥gica para guardar el dise√±o
                const designData = {
                    view: this.currentView,
                    garmentColor: this.garmentColor,
                    elements: this.elements
                };
                
                console.log('Dise√±o guardado:', designData);
                alert('Dise√±o guardado correctamente');
            }
            
            draw() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Dibujar prenda base
                this.drawGarment();
                
                // Dibujar elementos
                this.elements.forEach(element => {
                    this.drawElement(element);
                });
                
                // Dibujar selecci√≥n
                if (this.selectedElement) {
                    this.drawSelection(this.selectedElement);
                }
            }
            
            drawGarment() {
                if (this.garmentImage) {
                    this.ctx.drawImage(this.garmentImage, 0, 0, this.canvas.width, this.canvas.height);
                } else {
                    this.ctx.fillStyle = this.garmentColor;
                    
                    if (this.currentView === 'front') {
                        this.drawFrontGarment();
                    } else {
                        this.drawBackGarment();
                    }
                }
            }
            
            drawFrontGarment() {
                const width = this.canvas.width;
                const height = this.canvas.height;
                
                this.ctx.beginPath();
                this.ctx.moveTo(width * 0.2, height * 0.1);
                this.ctx.lineTo(width * 0.8, height * 0.1);
                this.ctx.lineTo(width * 0.9, height * 0.4);
                this.ctx.lineTo(width * 0.9, height * 0.9);
                this.ctx.lineTo(width * 0.1, height * 0.9);
                this.ctx.lineTo(width * 0.1, height * 0.4);
                this.ctx.closePath();
                this.ctx.fill();
            }
            
            drawBackGarment() {
                const width = this.canvas.width;
                const height = this.canvas.height;
                
                this.ctx.beginPath();
                this.ctx.moveTo(width * 0.2, height * 0.1);
                this.ctx.lineTo(width * 0.8, height * 0.1);
                this.ctx.lineTo(width * 0.85, height * 0.9);
                this.ctx.lineTo(width * 0.15, height * 0.9);
                this.ctx.closePath();
                this.ctx.fill();
            }
            
            drawElement(element) {
                this.ctx.save();
                
                // Transformaciones
                this.ctx.translate(element.x + element.width / 2, element.y + element.height / 2);
                this.ctx.rotate(element.rotation * Math.PI / 180);
                this.ctx.scale(element.scaleX, element.scaleY);
                this.ctx.globalAlpha = element.opacity / 100;
                
                if (element.type === 'image' && element.image) {
                    this.ctx.drawImage(
                        element.image,
                        -element.width / 2,
                        -element.height / 2,
                        element.width,
                        element.height
                    );
                } else if (element.type === 'text') {
                    this.ctx.fillStyle = element.color || '#000000';
                    this.ctx.font = `${element.fontSize}px ${element.fontFamily}`;
                    this.ctx.textAlign = 'center';
                    this.ctx.textBaseline = 'middle';
                    this.ctx.fillText(element.text, 0, 0);
                }
                
                this.ctx.restore();
            }
            
            drawSelection(element) {
                this.ctx.save();
                this.ctx.strokeStyle = '#3498db';
                this.ctx.lineWidth = 2;
                this.ctx.setLineDash([5, 5]);
                
                this.ctx.translate(element.x + element.width / 2, element.y + element.height / 2);
                this.ctx.rotate(element.rotation * Math.PI / 180);
                
                this.ctx.strokeRect(
                    -element.width / 2,
                    -element.height / 2,
                    element.width,
                    element.height
                );
                
                this.ctx.restore();
            }
        }
        
        // Inicializar el dise√±ador cuando se carga la p√°gina
        let designer;
        window.addEventListener('load', () => {
            designer = new InteractiveDesigner();
        });
        
        // Funcionalidades adicionales
        let quantity = 1;
        document.getElementById('decrease').addEventListener('click', function() {
            if (quantity > 1) {
                quantity--;
                document.getElementById('quantity').textContent = quantity;
            }
        });
        
        document.getElementById('increase').addEventListener('click', function() {
            quantity++;
            document.getElementById('quantity').textContent = quantity;
        });
        
        document.querySelector('.add-to-cart').addEventListener('click', function() {
            alert('Dise√±o a√±adido al carrito');
        });
    </script>
</body>
</html>